let updateAdminPlatform,textareas,filesInput,numberInputs,submitContainer,editPageForm,deleteCollectionItemButtons,editCollectionItemForm,wysiwygFilesToDelete=[];function manageImageDeletionInWysiwyg(e,t){let n=e.split('<img src="'),i=t.split('<img src="');if(n.length>i.length)for(let e=0;e<n.length;e++)if(e==n.length-1||n[e].indexOf('">')!=i[e].indexOf('">')){let t=n[e].indexOf('">');wysiwygFilesToDelete.push(n[e].substring(0,t)),console.log(wysiwygFilesToDelete);break}}function setPellEditorFor(e){let t=e.querySelector(".pell"),n=e.querySelector(".wysiwyg-output");pell.init({element:t,onChange:e=>{manageImageDeletionInWysiwyg(n.value,e),n.value=e,submitContainer.classList.add("clickable")},defaultParagraphSeparator:"p",actions:[{name:"heading1",icon:"H1"},{name:"heading2",icon:"H2"},{name:"paragraph",icon:"P"},{name:"quote",icon:"‚Äú ‚Äù"},{name:"bold",icon:"<strong>B</strong>"},{name:"olist",icon:"1."},{name:"ulist",icon:"‚Ä¢"},{name:"link",icon:"üîó"},{name:"Photo",icon:"üì∑",title:"Insert a photo",result:()=>e.querySelector(".pell-file-input").click()}]}),t.querySelector(".pell-content").innerHTML=n.value}function manageClassicImageInputEdition(e){let t=document.querySelector("#image_"+e.getAttribute("name")),n=t.parentElement.offsetWidth,i=t.parentElement.offsetHeight;t.onload=function(){i/n>this.naturalHeight/this.naturalWidth?(t.classList.add("fullHeight"),t.classList.remove("fullWidth")):(t.classList.remove("fullHeight"),t.classList.add("fullWidth"))};let o=new FileReader;o.onload=(e=>t.src=e.target.result),o.readAsDataURL(e.files[0]),submitContainer.classList.add("clickable")}function manageWysiwygImageInputEdition(e){null!=e.files[0]&&(e.parentElement.querySelector(".pell-content").focus(),uploadFile(e.files[0],t=>{e.parentElement.querySelector(".pell-content").focus(),document.execCommand("insertImage",!1,t),submitContainer.classList.add("clickable")}))}function uploadFile(e,t){let n=document.querySelector("#pageName").getAttribute("data-url"),i=new FormData;i.append("file",e),i.append("destination","files/"+n),fetch("php/actions/savePictureForWysiwyg.php",{method:"POST",body:i}).then(function(e){return e.text()}).then(function(e){t(e)})}function setHome(){null!=(updateAdminPlatform=document.querySelector("#updateAdminPlatform"))&&updateAdminPlatform.addEventListener("click",function(e){e.preventDefault(),fetch("updateAdminPlatform.php").then(function(e){return e.text()}).then(function(e){console.log(e),window.location.reload()})})}function getFormData(e){let t=new FormData(e);return t.append("wysiwygFilesToDelete",JSON.stringify(wysiwygFilesToDelete)),wysiwygFilesToDelete=[],t}function setForm(){submitContainer=document.querySelector(".submitContainer"),(textareas=document.querySelectorAll("textarea")).forEach(e=>{e.style.height=e.scrollHeight+"px",e.addEventListener("input",function(){this.style.height="auto",this.style.height=this.scrollHeight+"px",submitContainer.classList.add("clickable")})}),wysiwygInputs=document.querySelectorAll(".pell-input-box"),wysiwygInputs.forEach(e=>{setPellEditorFor(e)}),(numberInputs=document.querySelectorAll("input[name^=number_]")).forEach(e=>{e.addEventListener("input",function(){isNaN(this.value)&&(this.value=this.value.replace(",","."),this.value=this.value.replace(/[^\d\.]+/g,"")),submitContainer.classList.add("clickable")})}),(filesInput=document.querySelectorAll('input[type="file"]')).forEach(e=>{e.addEventListener("change",function(){e.classList.contains("classic-image-input")?manageClassicImageInputEdition(this):manageWysiwygImageInputEdition(this)})})}function setEditPage(){(editPageForm=document.querySelector("#editPageForm")).addEventListener("submit",function(e){e.preventDefault(),submitContainer.classList.add("loading"),fetch(this.getAttribute("action"),{method:"POST",body:getFormData(this)}).then(function(e){return submitContainer.classList.remove("loading"),200==e.status&&submitContainer.classList.remove("clickable"),e.text()}).then(function(e){console.log(e)})}),setForm()}function setEditCollection(){(deleteCollectionItemButtons=document.querySelectorAll(".deleteButton")).forEach(e=>{e.addEventListener("click",function(t){if(t.preventDefault(),window.confirm("Voulez vous vraiment supprimer cet √©l√©ment ?")){let t=e.parentNode;t.classList.add("waiting"),fetch(this.getAttribute("href")).then(function(e){200==e.status?t.parentNode.removeChild(t):t.classList.remove("waiting")})}})})}function setEditCollectionItem(){(editCollectionItemForm=document.querySelector("#editCollectionItemForm")).addEventListener("submit",function(e){e.preventDefault(),submitContainer.classList.add("loading"),fetch(this.getAttribute("action"),{method:"POST",body:getFormData(this)}).then(function(e){return submitContainer.classList.remove("loading"),200==e.status&&submitContainer.classList.remove("clickable"),e.text()}).then(function(e){if("newItem"==editCollectionItemForm.getAttribute("data-id")){let t=editCollectionItemForm.getAttribute("data-page");window.location.href="editCollectionItem?page="+t+"&id="+e}})}),setForm()}-1!=document.URL.indexOf("editPage")?setEditPage():-1!=document.URL.indexOf("editCollection")?setEditCollection():-1!=document.URL.indexOf("editCollectionItem")?setEditCollectionItem():setHome();