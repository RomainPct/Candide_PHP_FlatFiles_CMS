function setPellEditorFor(e){let t=e.querySelector(".pell"),n=e.querySelector(".wysiwyg-output");pell.init({element:t,onChange:e=>{n.value=e,submitContainer.classList.add("clickable")},defaultParagraphSeparator:"p",actions:[{name:"heading1",icon:"H1"},{name:"heading2",icon:"H2"},{name:"paragraph",icon:"P"},{name:"quote",icon:"‚Äú ‚Äù"},{name:"bold",icon:"<strong>B</strong>"},{name:"olist",icon:"1."},{name:"ulist",icon:"‚Ä¢"},{name:"link",icon:"üîó"},{name:"Photo",icon:"üì∑",title:"Insert a photo",result:()=>e.querySelector(".pell-file-input").click()}]});let i=t.querySelector(".pell-content");i.innerHTML=n.value,i.addEventListener("drop",handleDropFileInWysiwyg,!1)}function handleDropFileInWysiwyg(t){if(t.dataTransfer.files.length>0){t.stopPropagation(),t.preventDefault();var n=document.getSelection();let i;document.caretRangeFromPoint?(i=document.caretRangeFromPoint(t.clientX,t.clientY),n.removeAllRanges()):e.rangeParent?((i=document.createRange()).setStart(t.rangeParent,t.rangeOffset),n.removeAllRanges()):0==n.rangeCount&&(i=document.createRange()),n.addRange(i),manageWysiwygImageInputEdition(t.dataTransfer.files,t.currentTarget)}}function manageClassicImageInputEdition(e){if(null!=e.files[0]){let t=document.querySelector("#image_"+e.getAttribute("name")),n=t.parentElement.offsetWidth,i=t.parentElement.offsetHeight;t.onload=function(){i/n>this.naturalHeight/this.naturalWidth?(t.classList.add("fullHeight"),t.classList.remove("fullWidth")):(t.classList.remove("fullHeight"),t.classList.add("fullWidth"))};let o=new FileReader;o.onload=(e=>t.src=e.target.result),o.readAsDataURL(e.files[0]),submitContainer.classList.add("clickable")}}let updateAdminPlatform,textareas,filesInput,numberInputs,submitContainer,deleteCollectionItemButtons,editCollectionItemForm,newWysiwygFiles=[];function manageWysiwygImageInputEdition(e,t){if(null!=e[0]){let n=new FileReader;n.onload=(n=>{t.focus(),newWysiwygFiles.push({pellOutput:t.parentElement.parentElement.querySelector(".wysiwyg-output"),imageSrc:n.target.result,file:e[0]}),document.execCommand("insertImage",!1,n.target.result)}),n.readAsDataURL(e[0])}}function setHome(){null!=(updateAdminPlatform=document.querySelector("#updateAdminPlatform"))&&updateAdminPlatform.addEventListener("click",function(e){e.preventDefault(),fetch("updateAdminPlatform.php").then(function(e){return e.text()}).then(function(e){console.log(e),window.location.reload()})})}function setForm(){allowCmdS(),submitContainer=document.querySelector(".submitContainer"),(textareas=document.querySelectorAll("textarea")).forEach(e=>{e.style.height=e.scrollHeight+"px",e.addEventListener("input",function(){this.style.height="auto",this.style.height=this.scrollHeight+"px",submitContainer.classList.add("clickable")})}),wysiwygInputs=document.querySelectorAll(".pell-input-box"),wysiwygInputs.forEach(e=>{setPellEditorFor(e)}),(numberInputs=document.querySelectorAll("input[name^=number_]")).forEach(e=>{e.addEventListener("input",function(){isNaN(this.value)&&(this.value=this.value.replace(",","."),this.value=this.value.replace(/[^\d\.]+/g,"")),submitContainer.classList.add("clickable")})}),(filesInput=document.querySelectorAll('input[type="file"]')).forEach(e=>{e.addEventListener("change",function(){e.classList.contains("classic-image-input")?manageClassicImageInputEdition(this):manageWysiwygImageInputEdition(this.files,this.querySelector("pell-content"))})})}function setEditPage(){setSubmitEvent(document.querySelector("#editPageForm")),setForm()}function setEditCollection(){(deleteCollectionItemButtons=document.querySelectorAll(".deleteButton")).forEach(e=>{e.addEventListener("click",function(t){if(t.preventDefault(),window.confirm("Voulez vous vraiment supprimer cet √©l√©ment ?")){let t=e.parentNode;t.classList.add("waiting"),fetch(this.getAttribute("href")).then(function(e){200==e.status?t.parentNode.removeChild(t):t.classList.remove("waiting")})}})})}function setEditCollectionItem(){setSubmitEvent(editCollectionItemForm=document.querySelector("#editCollectionItemForm"),function(e){if("newItem"==editCollectionItemForm.getAttribute("data-id")){let t=editCollectionItemForm.getAttribute("data-page");window.location.href="editCollectionItem?page="+t+"&id="+e}}),setForm()}function allowCmdS(){document.addEventListener("keydown",function(e){(window.navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)&&83==e.keyCode&&(e.preventDefault(),submitContainer.classList.contains("clickable")&&submitContainer.querySelector("input").click())},!1)}function setMenu(){document.querySelector("#js_hamburgerButton").addEventListener("click",function(e){e.preventDefault(),document.querySelector("body").classList.toggle("menuOpen")})}function setSubmitEvent(e,t=function(e){}){e.addEventListener("submit",function(e){e.preventDefault(),submitContainer.classList.contains("clickable")&&!submitContainer.classList.contains("loading")&&(submitContainer.classList.add("loading"),fetch(this.getAttribute("action"),{method:"POST",body:getFormData(this)}).then(function(e){return newWysiwygFiles.length>0?window.location.reload():200==e.status?successfulUpdate():submitContainer.classList.remove("loading"),e.text()}).then(function(e){console.log(e),t(e)}))})}function successfulUpdate(){filesInput.forEach(e=>{e.value=null}),submitContainer.classList.add("success"),setTimeout(function(){submitContainer.classList.remove("clickable","success"),setTimeout(function(){submitContainer.classList.remove("loading")},300)},1500)}function getFormData(e){newWysiwygFiles.forEach(e=>{e.id=generateGUID(),e.pellOutput.value=e.pellOutput.value.replace(e.imageSrc,e.id)});let t=new FormData(e);return newWysiwygFiles.forEach(e=>{t.append(e.id,e.file)}),t}function generateGUID(){let e=Date.now().toString(16)+Math.random().toString(16)+"0".repeat(16);return[e.substr(0,8),e.substr(8,4),"4000-8"+e.substr(13,3),e.substr(16,12)].join("-")}-1!=document.URL.indexOf("editPage")?setEditPage():-1!=document.URL.indexOf("editCollectionItem")?setEditCollectionItem():-1!=document.URL.indexOf("editCollection")?setEditCollection():setHome(),setMenu();