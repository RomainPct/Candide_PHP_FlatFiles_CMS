window.Slip=function(){"use strict";var accessibility_container={ariaRole:"listbox",tabIndex:0,focus:!1},accessibility_items={ariaRole:"option",tabIndex:-1,focus:!1},damnYouChrome=/Chrome\/[3-5]/.test(navigator.userAgent),needsBodyHandlerHack=damnYouChrome,compositorDoesNotOrderLayers=damnYouChrome,testElementStyle=document.createElement("div").style,transitionJSPropertyName="transition"in testElementStyle?"transition":"webkitTransition",transformJSPropertyName="transform"in testElementStyle?"transform":"webkitTransform",transformCSSPropertyName="webkitTransform"===transformJSPropertyName?"-webkit-transform":"transform",userSelectJSPropertyName="userSelect"in testElementStyle?"userSelect":"webkitUserSelect";testElementStyle[transformJSPropertyName]="translateZ(0)";var hwLayerMagicStyle=testElementStyle[transformJSPropertyName]?"translateZ(0) ":"",hwTopLayerMagicStyle=testElementStyle[transformJSPropertyName]?"translateZ(1px) ":"";testElementStyle=null;var globalInstances=0,attachedBodyHandlerHack=!1,nullHandler=function(){};function Slip(container,options){if("string"==typeof container&&(container=document.querySelector(container)),!container||!container.addEventListener)throw new Error("Please specify DOM node to attach to");if(!this||this===window)return new Slip(container,options);if(this.options=options=options||{},this.options.keepSwipingPercent=options.keepSwipingPercent||0,this.options.minimumSwipeVelocity=options.minimumSwipeVelocity||1,this.options.minimumSwipeTime=options.minimumSwipeTime||110,this.options.ignoredElements=options.ignoredElements||[],!Array.isArray(this.options.ignoredElements))throw new Error("ignoredElements must be an Array");this.cancel=this.setState.bind(this,this.states.idle),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseLeave=this.onMouseLeave.bind(this),this.onSelection=this.onSelection.bind(this),this.onContainerFocus=this.onContainerFocus.bind(this),this.setState(this.states.idle),this.attach(container)}function getTransform(node){var transform=node.style[transformJSPropertyName];if(transform)return{value:transform,original:transform};if(window.getComputedStyle){var style=window.getComputedStyle(node).getPropertyValue(transformCSSPropertyName);if(style&&"none"!==style)return{value:style,original:""}}return{value:"",original:""}}function findIndex(target,nodes){for(var originalIndex=0,listCount=0,i=0;i<nodes.length;i++)1===nodes[i].nodeType&&(listCount++,nodes[i]===target.node&&(originalIndex=listCount-1));return originalIndex}return Slip.prototype={container:null,options:{},state:null,target:null,usingTouch:!1,mouseHandlersAttached:!1,startPosition:null,latestPosition:null,previousPosition:null,canPreventScrolling:!1,states:{idle:function idleStateInit(){return this.removeMouseHandlers(),this.target&&(this.target.node.style.willChange="",this.target=null),this.usingTouch=!1,{allowTextSelection:!0}},undecided:function undecidedStateInit(){if(this.target.height=this.target.node.offsetHeight,this.target.node.style.willChange=transformCSSPropertyName,this.target.node.style[transitionJSPropertyName]="",this.dispatch(this.target.originalTarget,"beforewait"))var holdTimer=setTimeout(function(){var move=this.getAbsoluteMovement();this.canPreventScrolling&&move.x<15&&move.y<25&&this.dispatch(this.target.originalTarget,"beforereorder")&&this.setState(this.states.reorder)}.bind(this),300);else this.dispatch(this.target.originalTarget,"beforereorder")&&this.setState(this.states.reorder);return{leaveState:function(){clearTimeout(holdTimer)},onMove:function(){var move=this.getAbsoluteMovement();if(move.x>20&&move.y<Math.max(100,this.target.height)){if(this.dispatch(this.target.originalTarget,"beforeswipe",{directionX:move.directionX,directionY:move.directionY}))return this.setState(this.states.swipe),!1;this.setState(this.states.idle)}if(move.y>20&&this.setState(this.states.idle),move.x>1.2*move.y)return!1},onLeave:function(){this.setState(this.states.idle)},onEnd:function(){var allowDefault=this.dispatch(this.target.originalTarget,"tap");return this.setState(this.states.idle),allowDefault}}},swipe:function swipeStateInit(){var swipeSuccess=!1,container=this.container,originalIndex=findIndex(this.target,this.container.childNodes);function removeClass(){container.classList.remove("slip-swiping-container")}return container.classList.add("slip-swiping-container"),this.target.height=this.target.node.offsetHeight,{leaveState:function(){swipeSuccess?this.animateSwipe(function(target){if(target.node.style[transformJSPropertyName]=target.baseTransform.original,target.node.style[transitionJSPropertyName]="",this.dispatch(target.node,"afterswipe"))return removeClass(),!0;this.animateToZero(void 0,target)}.bind(this)):this.animateToZero(removeClass)},onMove:function(){var move=this.getTotalMovement();if(Math.abs(move.y)<this.target.height+20)return this.dispatch(this.target.node,"animateswipe",{x:move.x,originalIndex:originalIndex})&&(this.target.node.style[transformJSPropertyName]="translate("+move.x+"px,0) "+hwLayerMagicStyle+this.target.baseTransform.value),!1;this.dispatch(this.target.node,"cancelswipe"),this.setState(this.states.idle)},onLeave:function(){this.state.onEnd.call(this)},onEnd:function(){var move=this.getAbsoluteMovement(),velocity=move.x/move.time,swipedPercent=100*Math.abs((this.startPosition.x-this.previousPosition.x)/this.container.clientWidth),swiped=velocity>this.options.minimumSwipeVelocity&&move.time>this.options.minimumSwipeTime||this.options.keepSwipingPercent&&swipedPercent>this.options.keepSwipingPercent;return swiped?this.dispatch(this.target.node,"swipe",{direction:move.directionX,originalIndex:originalIndex})&&(swipeSuccess=!0):this.dispatch(this.target.node,"cancelswipe"),this.setState(this.states.idle),!swiped}}},reorder:function reorderStateInit(){var nodes;if(this.target.node.focus&&accessibility_items.focus&&this.target.node.focus(),this.target.height=this.target.node.offsetHeight,this.options.ignoredElements.length){var container=this.container,query=container.tagName.toLowerCase();container.getAttribute("id")?query="#"+container.getAttribute("id"):container.classList.length&&(query+="."+container.getAttribute("class").replace(" ",".")),query+=" > ",this.options.ignoredElements.forEach(function(selector){query+=":not("+selector+")"});try{nodes=container.parentNode.querySelectorAll(query)}catch(err){throw err instanceof DOMException&&"SyntaxError"===err.name?new Error("ignoredElements you specified contain invalid query"):err}}else nodes=this.container.childNodes;for(var originalIndex=findIndex(this.target,nodes),mouseOutsideTimer,zero=this.target.node.offsetTop+this.target.height/2,otherNodes=[],i=0;i<nodes.length;i++)if(1==nodes[i].nodeType&&nodes[i]!==this.target.node){var t=nodes[i].offsetTop;nodes[i].style[transitionJSPropertyName]=transformCSSPropertyName+" 0.2s ease-in-out",otherNodes.push({node:nodes[i],baseTransform:getTransform(nodes[i]),pos:t+(t<zero?nodes[i].offsetHeight:0)-zero})}function onMove(){this.updateScrolling(),mouseOutsideTimer&&(clearTimeout(mouseOutsideTimer),mouseOutsideTimer=null);var move=this.getTotalMovement();this.target.node.style[transformJSPropertyName]="translate(0,"+move.y+"px) "+hwTopLayerMagicStyle+this.target.baseTransform.value;var height=this.target.height;return otherNodes.forEach(function(o){var off=0;o.pos<0&&move.y<0&&o.pos>move.y?off=height:o.pos>0&&move.y>0&&o.pos<move.y&&(off=-height),o.node.style[transformJSPropertyName]=off?"translate(0,"+off+"px) "+hwLayerMagicStyle+o.baseTransform.value:o.baseTransform.original}),!1}return this.target.node.classList.add("slip-reordering"),this.target.node.style.zIndex="99999",this.target.node.style[userSelectJSPropertyName]="none",compositorDoesNotOrderLayers&&(this.container.style.webkitTransformStyle="preserve-3d"),onMove.call(this),{leaveState:function(){mouseOutsideTimer&&clearTimeout(mouseOutsideTimer),compositorDoesNotOrderLayers&&(this.container.style.webkitTransformStyle=""),this.container.focus&&accessibility_container.focus&&this.container.focus(),this.target.node.classList.remove("slip-reordering"),this.target.node.style[userSelectJSPropertyName]="",this.animateToZero(function(target){target.node.style.zIndex=""}),otherNodes.forEach(function(o){o.node.style[transformJSPropertyName]=o.baseTransform.original,o.node.style[transitionJSPropertyName]=""})},onMove:onMove,onLeave:function(){mouseOutsideTimer&&clearTimeout(mouseOutsideTimer),mouseOutsideTimer=setTimeout(function(){mouseOutsideTimer=null,this.cancel()}.bind(this),700)},onEnd:function(){var move=this.getTotalMovement(),i,spliceIndex;if(move.y<0){for(i=0;i<otherNodes.length&&!(otherNodes[i].pos>move.y);i++);spliceIndex=i}else{for(i=otherNodes.length-1;i>=0&&!(otherNodes[i].pos<move.y);i--);spliceIndex=i+1}return this.dispatch(this.target.node,"reorder",{spliceIndex:spliceIndex,originalIndex:originalIndex,insertBefore:otherNodes[spliceIndex]?otherNodes[spliceIndex].node:null}),this.setState(this.states.idle),!1}}}},attach:function(container){globalInstances++,this.container&&this.detach(),!attachedBodyHandlerHack&&needsBodyHandlerHack&&(attachedBodyHandlerHack=!0,document.body.addEventListener("touchstart",nullHandler,!1)),this.container=container,!1!==accessibility_container.tabIndex&&(this.container.tabIndex=accessibility_container.tabIndex),accessibility_container.ariaRole&&this.container.setAttribute("aria-role",accessibility_container.ariaRole),this.setChildNodesAriaRoles(),this.container.addEventListener("focus",this.onContainerFocus,!1),this.otherNodes=[],document.addEventListener("selectionchange",this.onSelection,!1),this.container.addEventListener("touchcancel",this.cancel,!1),this.container.addEventListener("touchstart",this.onTouchStart,!1),this.container.addEventListener("touchmove",this.onTouchMove,!1),this.container.addEventListener("touchend",this.onTouchEnd,!1),this.container.addEventListener("mousedown",this.onMouseDown,!1)},detach:function(){this.cancel(),this.container.removeEventListener("mousedown",this.onMouseDown,!1),this.container.removeEventListener("touchend",this.onTouchEnd,!1),this.container.removeEventListener("touchmove",this.onTouchMove,!1),this.container.removeEventListener("touchstart",this.onTouchStart,!1),this.container.removeEventListener("touchcancel",this.cancel,!1),document.removeEventListener("selectionchange",this.onSelection,!1),!1!==accessibility_container.tabIndex&&this.container.removeAttribute("tabIndex"),accessibility_container.ariaRole&&this.container.removeAttribute("aria-role"),this.unSetChildNodesAriaRoles(),!--globalInstances&&attachedBodyHandlerHack&&(attachedBodyHandlerHack=!1,document.body.removeEventListener("touchstart",nullHandler,!1))},setState:function(newStateCtor){if(this.state){if(this.state.ctor===newStateCtor)return;this.state.leaveState&&this.state.leaveState.call(this)}var prevState=this.state,nextState=newStateCtor.call(this);this.state===prevState&&(nextState.ctor=newStateCtor,this.state=nextState)},findTargetNode:function(targetNode){for(;targetNode&&targetNode.parentNode!==this.container;)targetNode=targetNode.parentNode;return targetNode},onContainerFocus:function(e){e.stopPropagation(),this.setChildNodesAriaRoles()},setChildNodesAriaRoles:function(){for(var nodes=this.container.childNodes,i=0;i<nodes.length;i++)1==nodes[i].nodeType&&(accessibility_items.ariaRole&&nodes[i].setAttribute("aria-role",accessibility_items.ariaRole),!1!==accessibility_items.tabIndex&&(nodes[i].tabIndex=accessibility_items.tabIndex))},unSetChildNodesAriaRoles:function(){for(var nodes=this.container.childNodes,i=0;i<nodes.length;i++)1==nodes[i].nodeType&&(accessibility_items.ariaRole&&nodes[i].removeAttribute("aria-role"),!1!==accessibility_items.tabIndex&&nodes[i].removeAttribute("tabIndex"))},onSelection:function(e){e.stopPropagation();var isRelated=e.target===document||this.findTargetNode(e),iOS=/(iPhone|iPad|iPod)/i.test(navigator.userAgent)&&!/(Android|Windows)/i.test(navigator.userAgent);isRelated&&(iOS?this.setState(this.states.idle):this.state.allowTextSelection||e.preventDefault())},addMouseHandlers:function(){this.mouseHandlersAttached||(this.mouseHandlersAttached=!0,document.documentElement.addEventListener("mouseleave",this.onMouseLeave,!1),window.addEventListener("mousemove",this.onMouseMove,!0),window.addEventListener("mouseup",this.onMouseUp,!0),window.addEventListener("blur",this.cancel,!1))},removeMouseHandlers:function(){this.mouseHandlersAttached&&(this.mouseHandlersAttached=!1,document.documentElement.removeEventListener("mouseleave",this.onMouseLeave,!1),window.removeEventListener("mousemove",this.onMouseMove,!0),window.removeEventListener("mouseup",this.onMouseUp,!0),window.removeEventListener("blur",this.cancel,!1))},onMouseLeave:function(e){e.stopPropagation(),this.usingTouch||e.target!==document.documentElement&&e.relatedTarget!==document.documentElement||this.state.onLeave&&this.state.onLeave.call(this)},onMouseDown:function(e){e.stopPropagation(),!this.usingTouch&&0==e.button&&this.setTarget(e)&&(this.addMouseHandlers(),this.canPreventScrolling=!0,this.startAtPosition({x:e.clientX,y:e.clientY,time:e.timeStamp}))},onTouchStart:function(e){e.stopPropagation(),this.usingTouch=!0,this.canPreventScrolling=!0,e.touches.length>1?this.setState(this.states.idle):this.setTarget(e)&&this.startAtPosition({x:e.touches[0].clientX,y:e.touches[0].clientY,time:e.timeStamp})},setTarget:function(e){var targetNode=this.findTargetNode(e.target);if(!targetNode)return this.setState(this.states.idle),!1;var scrollContainer=this.options.scrollContainer;if(!scrollContainer){var top=document.scrollingElement||document.documentElement;for(scrollContainer=targetNode.parentNode;scrollContainer&&scrollContainer!=top&&!(scrollContainer!=document.body&&scrollContainer.scrollHeight>scrollContainer.clientHeight&&"visible"!=window.getComputedStyle(scrollContainer)["overflow-y"]);)scrollContainer=scrollContainer.parentNode;scrollContainer=scrollContainer||top}return this.target={originalTarget:e.target,node:targetNode,scrollContainer:scrollContainer,origScrollTop:scrollContainer.scrollTop,origScrollHeight:scrollContainer.scrollHeight,baseTransform:getTransform(targetNode)},!0},startAtPosition:function(pos){this.startPosition=this.previousPosition=this.latestPosition=pos,this.setState(this.states.undecided)},updatePosition:function(e,pos){null!=this.target&&(this.latestPosition=pos,this.state.onMove&&!1===this.state.onMove.call(this)&&e.preventDefault(),this.latestPosition.time-this.previousPosition.time>100&&(this.previousPosition=this.latestPosition))},onMouseMove:function(e){e.stopPropagation(),this.updatePosition(e,{x:e.clientX,y:e.clientY,time:e.timeStamp})},onTouchMove:function(e){e.stopPropagation(),this.updatePosition(e,{x:e.touches[0].clientX,y:e.touches[0].clientY,time:e.timeStamp}),this.canPreventScrolling=!1},onMouseUp:function(e){e.stopPropagation(),this.usingTouch||0!==e.button||this.state.onEnd&&!1===this.state.onEnd.call(this)&&e.preventDefault()},onTouchEnd:function(e){e.stopPropagation(),e.touches.length>1?this.cancel():this.state.onEnd&&!1===this.state.onEnd.call(this)&&e.preventDefault()},getTotalMovement:function(){var scrollOffset=this.target.scrollContainer.scrollTop-this.target.origScrollTop;return{x:this.latestPosition.x-this.startPosition.x,y:this.latestPosition.y-this.startPosition.y+scrollOffset,time:this.latestPosition.time-this.startPosition.time}},getAbsoluteMovement:function(){var move=this.getTotalMovement();return{x:Math.abs(move.x),y:Math.abs(move.y),time:move.time,directionX:move.x<0?"left":"right",directionY:move.y<0?"up":"down"}},updateScrolling:function(){var triggerOffset=40,offset=0,scrollable=this.target.scrollContainer,containerRect=scrollable.getBoundingClientRect(),targetRect=this.target.node.getBoundingClientRect(),bottomOffset=Math.min(containerRect.bottom,window.innerHeight)-targetRect.bottom,topOffset=targetRect.top-Math.max(containerRect.top,0),maxScrollTop=this.target.origScrollHeight-Math.min(scrollable.clientHeight,window.innerHeight);bottomOffset<40?offset=Math.min(40,40-bottomOffset):topOffset<40&&(offset=Math.max(-40,topOffset-40)),scrollable.scrollTop=Math.max(0,Math.min(maxScrollTop,scrollable.scrollTop+offset))},dispatch:function(targetNode,eventName,detail){var event=document.createEvent("CustomEvent");return event&&event.initCustomEvent?event.initCustomEvent("slip:"+eventName,!0,!0,detail):((event=document.createEvent("Event")).initEvent("slip:"+eventName,!0,!0),event.detail=detail),targetNode.dispatchEvent(event)},getSiblings:function(target){for(var siblings=[],tmp=target.node.nextSibling;tmp;)1==tmp.nodeType&&siblings.push({node:tmp,baseTransform:getTransform(tmp)}),tmp=tmp.nextSibling;return siblings},animateToZero:function(callback,target){(target=target||this.target).node.style[transitionJSPropertyName]=transformCSSPropertyName+" 0.1s ease-out",target.node.style[transformJSPropertyName]="translate(0,0) "+hwLayerMagicStyle+target.baseTransform.value,setTimeout(function(){target.node.style[transitionJSPropertyName]="",target.node.style[transformJSPropertyName]=target.baseTransform.original,callback&&callback.call(this,target)}.bind(this),101)},animateSwipe:function(callback){var target=this.target,siblings=this.getSiblings(target),emptySpaceTransformStyle="translate(0,"+this.target.height+"px) "+hwLayerMagicStyle+" ";target.node.style[transitionJSPropertyName]="all 0.1s linear",target.node.style[transformJSPropertyName]=" translate("+(this.getTotalMovement().x>0?"":"-")+"100%,0) "+hwLayerMagicStyle+target.baseTransform.value,setTimeout(function(){callback.call(this,target)&&(siblings.forEach(function(o){o.node.style[transitionJSPropertyName]="",o.node.style[transformJSPropertyName]=emptySpaceTransformStyle+o.baseTransform.value}),setTimeout(function(){siblings.forEach(function(o){o.node.style[transitionJSPropertyName]=transformCSSPropertyName+" 0.1s ease-in-out",o.node.style[transformJSPropertyName]="translate(0,0) "+hwLayerMagicStyle+o.baseTransform.value}),setTimeout(function(){siblings.forEach(function(o){o.node.style[transitionJSPropertyName]="",o.node.style[transformJSPropertyName]=o.baseTransform.original})},101)},1))}.bind(this),101)}},"function"==typeof define&&define.amd&&define(function(){return Slip}),"object"==typeof module&&module.exports&&(module.exports=Slip),Slip}();